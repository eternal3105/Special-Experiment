## 目錄

這裡是我們的目錄 會分為八大部份講述

## 動機

因為在專題展中看到學長展示的專題而對ROS機器人產生濃厚的興趣，而在摸索的過程中也在思考著這樣的一個自走車到底能達到怎麼樣的一個上限。最後，我們實作了這個自走車系統。

## 目的

我們的作品，災難救助遙測機器人。是一個專門為救災人員而實作的一個系統。救助的部分有地圖及導航部分，遙測則是搖桿控制以及攝影機校正及環景串流。在這其中，我們讓使用著遠離了令人畏懼的指令輸入模式，以網頁的方式呈現使用者介面，並讓程式在背景執行，最佳化使用者體驗。

## 系統架構(架構圖)

這是我們的架構設計圖，分為載具端、伺服器端、網頁端，載具端會負責接收各種數據，交由伺服器端進行中間運算，並且將我們的計算結果即時的輸出到網頁上。

## 介面設計

而我們的網頁端，則負責展示我們所實做的所有功能。包括實時監控、即時環景、即時地圖三大部分，而我們也在此做了優化，讓使用者能夠更加簡易的開啟各項功能，在監控畫面的部分，我們拆解了癮向串流的流程，讓CPU附載更加健康的同時減少使用者所需的操作，這個部分接下來會在功能介紹進一步展示。

## 使用工具

接下來是使用工具的部份，我們系統是遵循了前後端分散式系統，前端的部分我們利用HTML與JS加上css做出網頁讓使用者使用，而後端的部分是我們的伺服器，用的是ubuntu18.04的作業系統，伺服器負責的事情是前端與後端資料傳輸與資料的計算，最終將計算完成的資料傳遞到載具ROSKY上，同時攝影機的資料也會通過伺服器到我們的網頁上。

## 功能介紹—搖桿控車

接下來是功能介紹的部分，首先，為了讓使用者更加便利的操作自走車穿梭於各類地形，我們實作了搖桿控車功能。

接下來講述我們是如何辦到的，我們的搖桿訊號會經過usb傳輸到伺服器端，而臥門的程式會接收搖桿驅動程式發出的訊號並轉換成ROS專用訊號，進而達到控制載具的功能。

## 功能介紹—實時監控

下一項功能，是我們的攝影機網格監控的部分，我們將載具上的6台攝影機的畫面通過網頁串流的方式傳送到我們的網頁上，讓使用者可以看到即時的影像，同時我們還實作了單點監控讓使用者可以針對某一個影像進行放大觀看。

在網格監控中任點其中一張圖，將會進入單點監控模式，此時的畫面會更放大且可供切換，提供更加細緻觀察方式。

而剛才的畫面者要是靠我們自走車上搭仔的六顆魚眼鏡頭來實現，選擇魚眼鏡頭是為了能夠或的更大的事業範圍，而其中免不了的就是魚眼景頭的畸變問題，而這裡我們用C++配合棋盤格標定法，獲得每一台攝影機校正的參數，配合opencv校正所有參數並且串流到網頁望成為我們的時時監控系統。

## 功能介紹—環景

下一項功能是環景的部分，藉由上面矯正後的6個影像我們進行融合變成一張環景的影像

具體是怎做到的呢?
我們將兩個影像的邊界切出來，進行多頻帶融合，其中運用到拉普拉絲金字塔融合。
至於實際流程是甚麼呢?
多頻帶融合是將影像的某一幀箱拆分成R、G、B三個頻帶再生成出每一個頻帶的高斯金字塔，再藉由每兩層高斯金字塔的差集獲得拉普拉斯金字塔，將兩座拉普拉斯金字塔的每一層進行加權融合，最後高斯金字塔配合拉普拉絲金字塔還原成原本大小的影像。在將影像串接起來就可以地到融合後的影像，我們在重複以上的動作6次，就可以得到一張環景的影像。

## 功能介紹—地圖

接下來的功能介紹就是地圖繪製功能，最一開始網頁端會發送一個啟動訊號到自走車端開啟gmapping繪圖功能，並且等待gmapping發布的地圖訊號，轉換成灰階圖顯示在網頁上。

## 設計實驗

我們在環景融合找到一些參數做調整，以下是實驗對比圖

我們製作環景影像時，其中有一組參數是負責決定要用多少比例的影像去熔接整段影像，我們發現這些參數會影響到我們的融合成果，我們先找到了一組在統一的距離底下可以相對完美融合的參數，對這些參數進行，線性放大或縮小可以讓相對完美融合的距離變遠或變近。

## 遇到困難—導航

### 功能之間衝突

我們的主要功能之間共用了許多硬體，而這些硬體很多時候都只能在一個地方開啟，而協調這些衝突，成為了我們專題號時做多時間的部分。

### 時間軸的排序

許多的軟體之間也存在相依性的問題，我們這個專題自製程式可以說是非常的多，而這些功能的資料傳輸都需要它們各自的時間軸。

我們拆分了導航需要的所有的所需套件，包括三大部分

- cpu負荷問題
- 車輪控制
- 光達訊號
- 地圖輸入

其中cup負荷問題，我們拆分並重組了影片傳輸模式，讓車上cpu進一步降低，可以達到雙核加起來不到100%的效果(可以達到導航標準)。

下一頁會重點提及我們實做的功能。

其中車輪控制的部分，在之前的搖桿控制部分，我們有對其做攔截及輸入，

這就導致了導航的車輪控制和搖桿的車輪控制衝突，最終形成衝突結束程式的結果。而這邊以邏輯上來說該關閉我們自製程式碼，但這邊關閉後會導致網頁端和伺服器端中斷溝通；另一方面如果關閉了導航的車輪控制，會繼續進行下一步光達訊號的問題。

光達訊號的部分同樣也有衝突問題，這裡理論上關閉哪邊的開啟訊號都是可以成功的，

這裡的問題是:

- 光達訊號節點不一致 這個我們靠relay解決了問題
- 導航同樣會與車輪控制程式衝突，這裡我們嘗試關閉導航的光達訊號，但其他的相依程式對於光達的依賴程度太高，會導致導航的致命錯誤導致關閉。

結論: 在這導航上我看不到繼續下去的希望，但是我們在優化方面得到長足進展。

## 結論與未來展望

簡化操作難度: 這個版本的專題更進一步的新增了觸發式啟動的功能。

YOLOv7: 我認為小組可以向YOLOv7前進，讓物件辨識回歸專題，並且嘗試cpu執行